<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building an Automated LLM Scoring Service: From Prototype to Production — Humza Tareen</title>
  <meta name="description" content="How I built and hardened an automated rating service that scores LLM outputs. From idempotent Cloud Tasks to LiteLLM proxy, Redis state management, and VPC networking battles.">
  <meta name="author" content="Humza Tareen">
  <meta name="keywords" content="LLM, Auto-Rating, Cloud Run, Cloud Tasks, Redis, LiteLLM, PostgreSQL, Python, FastAPI">
  <link rel="canonical" href="https://humzakt.github.io/blog/auto-rater-service-llm-scoring.html">
  <meta property="og:title" content="Building an Automated LLM Scoring Service: From Prototype to Production">
  <meta property="og:description" content="How I built and hardened an automated rating service that scores LLM outputs. From idempotent Cloud Tasks to LiteLLM proxy, Redis state management, and VPC networking battles.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://humzakt.github.io/blog/auto-rater-service-llm-scoring.html">
  <meta property="og:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <meta property="og:site_name" content="Humza Tareen">
  <meta property="article:published_time" content="2026-02-08T00:00:00Z">
  <meta property="article:author" content="Humza Tareen">
  <meta property="article:tag" content="Cloud Run">
  <meta property="article:tag" content="Cloud Tasks">
  <meta property="article:tag" content="Redis">
  <meta property="article:tag" content="LiteLLM">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="FastAPI">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building an Automated LLM Scoring Service: From Prototype to Production">
  <meta name="twitter:description" content="Idempotent Cloud Tasks, LiteLLM proxy, Redis state management, and VPC networking battles.">
  <meta name="twitter:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Building an Automated LLM Scoring Service: From Prototype to Production",
    "description": "How I built and hardened an automated rating service that scores LLM outputs.",
    "image": "https://humzakt.github.io/suit-blue-bg.jpg",
    "author": { "@type": "Person", "name": "Humza Tareen", "url": "https://humzakt.github.io" },
    "publisher": { "@type": "Person", "name": "Humza Tareen" },
    "datePublished": "2026-02-08",
    "dateModified": "2026-02-08",
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://humzakt.github.io/blog/auto-rater-service-llm-scoring.html" },
    "keywords": ["Cloud Run", "Cloud Tasks", "Redis", "LiteLLM", "Python", "FastAPI"],
    "articleSection": "AI Infrastructure"
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="../styles.css">
  <link rel="alternate" type="application/rss+xml" title="Humza Tareen Blog" href="https://humzakt.github.io/blog/feed.xml">
  <style>
    .blog-post { max-width: 800px; margin: 0 auto; padding: calc(var(--nav-height) + 40px) 24px 80px; }
    .blog-back { display: inline-flex; align-items: center; gap: 8px; color: var(--accent); font-family: var(--font-mono); font-size: 14px; margin-bottom: 32px; }
    .blog-back:hover { gap: 12px; }
    .blog-header { margin-bottom: 40px; }
    .blog-title { font-size: clamp(28px, 5vw, 42px); color: var(--heading); line-height: 1.2; margin-bottom: 16px; font-weight: 700; }
    .blog-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 16px; color: var(--text); font-size: 14px; font-family: var(--font-mono); margin-bottom: 24px; }
    .blog-meta time { color: var(--accent); }
    .blog-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
    .blog-tag { font-size: 12px; padding: 4px 12px; border-radius: 20px; background: rgba(100,255,218,0.08); color: var(--accent); font-family: var(--font-mono); }
    .blog-content { color: var(--text-light); line-height: 1.8; font-size: 17px; }
    .blog-content h2 { color: var(--heading); font-size: 24px; margin: 48px 0 16px; font-weight: 600; }
    .blog-content h3 { color: var(--heading); font-size: 20px; margin: 32px 0 12px; font-weight: 600; }
    .blog-content p { margin-bottom: 20px; }
    .blog-content ul, .blog-content ol { margin-bottom: 20px; padding-left: 24px; }
    .blog-content li { margin-bottom: 8px; }
    .blog-content strong { color: var(--heading); font-weight: 600; }
    .blog-content code { font-family: var(--font-mono); font-size: 0.9em; background: var(--bg-light); padding: 2px 6px; border-radius: 4px; color: var(--accent); }
    .blog-content pre { background: var(--bg-light); border: 1px solid var(--card-border); border-radius: 8px; padding: 20px; overflow-x: auto; margin-bottom: 24px; font-size: 14px; line-height: 1.6; }
    .blog-content pre code { background: none; padding: 0; color: var(--text-light); }
    .blog-content a { color: var(--accent); text-decoration: underline; text-underline-offset: 3px; }
    .blog-content a:hover { color: var(--heading); }
    .blog-content table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 15px; }
    .blog-content th, .blog-content td { padding: 12px 16px; border: 1px solid var(--card-border); text-align: left; }
    .blog-content th { background: var(--bg-light); color: var(--heading); font-weight: 600; }
    .blog-footer { margin-top: 60px; padding-top: 32px; border-top: 1px solid var(--card-border); }
    .blog-author { display: flex; align-items: center; gap: 16px; }
    .blog-author-img { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
    .blog-author-info h4 { color: var(--heading); font-size: 16px; }
    .blog-author-info p { color: var(--text); font-size: 14px; }
    .blog-cta { margin-top: 32px; text-align: center; }
    .blog-cta a { display: inline-block; padding: 12px 28px; border: 1px solid var(--accent); color: var(--accent); border-radius: 6px; font-family: var(--font-mono); font-size: 14px; transition: var(--transition); }
    .blog-cta a:hover { background: var(--accent-muted); }
    @media (max-width: 768px) { .blog-post { padding-top: calc(var(--nav-height) + 20px); } .blog-content { font-size: 16px; } }
  </style>
</head>
<body>
  <nav class="nav" id="nav" aria-label="Main navigation">
    <a href="../index.html" class="nav-logo" aria-label="Humza Tareen - Home">HT</a>
    <div class="nav-links" role="list">
      <div class="page-switcher"><a href="../engineering.html">Engineering</a><a href="../research.html">Research</a></div>
      <a href="../engineering.html#articles" role="listitem">All Articles</a>
      <a href="../engineering.html#contact" class="nav-cta" role="listitem">Hire Me</a>
    </div>
  </nav>
  <main class="blog-post">
    <a href="../engineering.html#articles" class="blog-back"><i class="fas fa-arrow-left"></i> All Articles</a>
    <article>
      <header class="blog-header">
        <h1 class="blog-title">Building an Automated LLM Scoring Service: From Prototype to Production</h1>
        <div class="blog-meta"><time datetime="2026-02-08">Feb 8, 2026</time><span>&middot;</span><span>10 min read</span><span>&middot;</span><span>Humza Tareen</span></div>
        <div class="blog-tags">
          <span class="blog-tag">Cloud Run</span><span class="blog-tag">Cloud Tasks</span><span class="blog-tag">Redis</span><span class="blog-tag">LiteLLM</span><span class="blog-tag">Python</span><span class="blog-tag">FastAPI</span>
        </div>
      </header>
      <div class="blog-content">
        <h2>What This Service Does</h2>
        <p>The Auto-Rater evaluates LLM outputs using configurable scoring criteria. It takes an agent's output, runs it through multiple evaluation strategies (direct scoring, debate, chain-of-thought), and produces structured quality assessments. I led the engineering effort taking it from prototype to production.</p>
        <h2>The v1 → v2 Migration</h2>
        <p><strong>v1 Problems:</strong> Hardcoded model names, no idempotency (Cloud Tasks retries created duplicates), pervasive <code>print()</code> statements, Redis client with no timeouts, DB pool sized for dev.</p>
        <h2>Idempotent Cloud Tasks</h2>
        <p>Most impactful pattern. Cloud Tasks delivers at-least-once, so every handler must be idempotent. Added idempotent writes for COT generations, then extended to all evaluation writes with deterministic IDs from payload using <code>INSERT ... ON CONFLICT DO NOTHING</code>. Zero duplicate evaluations since deployment.</p>
        <h2>The Logging Overhaul</h2>
        <p>Replaced every <code>print()</code> with structured logging. Added env-driven config, correlation IDs via <code>X-Correlation-ID</code>, cross-service correlation with notification service, PII stripping.</p>
        <h2>OpenAI Responses Envelope</h2>
        <p>OpenAI-compatible responses envelope with LiteLLM pass-through. Any model available through LiteLLM works without code changes — just change model name in config.</p>
        <h2>The VPC Connector Saga</h2>
        <p>3-day debugging marathon. Cloud Run couldn't connect to Redis (Memorystore). Added socket timeouts to prevent infinite hangs, then added VPC connector. Discovered Direct VPC Egress conflicting with connector. Removed VPC connector (infra had moved to Direct VPC). Lesson: Cloud Run networking has two mutually exclusive modes.</p>
        <h2>Redis State Recovery</h2>
        <p>Evaluations take 1-30 min. Frontend polls Redis for progress. Discovered state updates logging "success" even when key didn't exist. Rewrote Redis state management to verify results and create recovery records.</p>
        <h2>Production Hardening</h2>
        <p>Cloud Run defaults to 80 concurrent requests. Each holds DB connection. 80 × 10 instances = 800 connections against Cloud SQL supporting ~100. Fix: <code>containerConcurrency=10</code>, <code>uvicorn workers=1</code>, <code>pool_size=5</code>, <code>max_overflow=10</code>.</p>
        <h2>Impact</h2>
        <table>
          <tr><th>Metric</th><th>Value</th></tr>
          <tr><td>Issues filed</td><td>Dozens of issues filed and resolved</td></tr>
          <tr><td>Timeframe</td><td>Aug 2025 — Feb 2026</td></tr>
          <tr><td>GCP services</td><td>Cloud Run, Cloud Tasks, Cloud SQL, Redis (Memorystore), GCS, Pub/Sub, Secret Manager</td></tr>
        </table>
      </div>
      <footer class="blog-footer">
        <div class="blog-author"><img src="../suit-blue-bg.jpg" alt="Humza Tareen" class="blog-author-img"><div class="blog-author-info"><h4>Humza Tareen</h4><p>AI Engineer building production systems at scale. <a href="../engineering.html">View full portfolio</a></p></div></div>
        <div class="blog-cta"><a href="../engineering.html#articles">Read More Articles</a></div>
      </footer>
    </article>
  </main>
</body>
</html>
