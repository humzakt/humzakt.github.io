<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building an RL Training Arena: Gym-Style API and Cloud Build Sandboxing — Humza Tareen</title>
  <meta name="description" content="How I built a reinforcement learning arena for AI coding agents with Gym-style API, Cloud Build sandboxing, Redis episode management, and a 15-step preprocessor.">
  <meta name="author" content="Humza Tareen">
  <meta name="keywords" content="Reinforcement Learning, GKE, Cloud Build, Redis, Firestore, Python, FastAPI, Gym API">
  <link rel="canonical" href="https://humzakt.github.io/blog/rl-arena-executor-preprocessor.html">
  <link rel="author" href="https://humzakt.github.io/llms.txt" type="text/plain" title="LLMs.txt">
  <meta property="og:title" content="Building an RL Training Arena: Gym-Style API and Cloud Build Sandboxing">
  <meta property="og:description" content="How I built a reinforcement learning arena for AI coding agents with Gym-style API, Cloud Build sandboxing, Redis episode management, and a 15-step preprocessor.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://humzakt.github.io/blog/rl-arena-executor-preprocessor.html">
  <meta property="og:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="Humza Tareen">
  <meta property="article:published_time" content="2026-02-08T00:00:00Z">
  <meta property="article:author" content="Humza Tareen">
  <meta property="article:tag" content="Reinforcement Learning">
  <meta property="article:tag" content="GKE">
  <meta property="article:tag" content="Cloud Build">
  <meta property="article:tag" content="Redis">
  <meta property="article:tag" content="Python">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building an RL Training Arena: Gym-Style API and Cloud Build Sandboxing">
  <meta name="twitter:description" content="How I built a reinforcement learning arena for AI coding agents with Gym-style API, Cloud Build sandboxing, Redis episode management, and a 15-step preprocessor.">
  <meta name="twitter:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Building an RL Training Arena: Gym-Style API and Cloud Build Sandboxing",
    "description": "How I built a reinforcement learning arena for AI coding agents with Gym-style API, Cloud Build sandboxing, Redis episode management, and a 15-step preprocessor.",
    "image": "https://humzakt.github.io/suit-blue-bg.jpg",
    "author": { "@type": "Person", "name": "Humza Tareen", "url": "https://humzakt.github.io" },
    "publisher": { "@type": "Person", "name": "Humza Tareen" },
    "datePublished": "2026-02-08",
    "dateModified": "2026-02-08",
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://humzakt.github.io/blog/rl-arena-executor-preprocessor.html" },
    "keywords": ["Reinforcement Learning", "GKE", "Cloud Build", "Redis", "Firestore", "Python", "FastAPI", "Gym API"],
    "articleSection": "ML Infrastructure"
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="../styles.css">
  <link rel="alternate" type="application/rss+xml" title="Humza Tareen Blog" href="https://humzakt.github.io/blog/feed.xml">
  <style>
    .blog-post { max-width: 800px; margin: 0 auto; padding: calc(var(--nav-height) + 40px) 24px 80px; }
    .blog-back { display: inline-flex; align-items: center; gap: 8px; color: var(--accent); font-family: var(--font-mono); font-size: 14px; margin-bottom: 32px; }
    .blog-back:hover { gap: 12px; }
    .blog-header { margin-bottom: 40px; }
    .blog-title { font-size: clamp(28px, 5vw, 42px); color: var(--heading); line-height: 1.2; margin-bottom: 16px; font-weight: 700; }
    .blog-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 16px; color: var(--text); font-size: 14px; font-family: var(--font-mono); margin-bottom: 24px; }
    .blog-meta time { color: var(--accent); }
    .blog-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
    .blog-tag { font-size: 12px; padding: 4px 12px; border-radius: 20px; background: rgba(100,255,218,0.08); color: var(--accent); font-family: var(--font-mono); }
    .blog-content { color: var(--text-light); line-height: 1.8; font-size: 17px; }
    .blog-content h2 { color: var(--heading); font-size: 24px; margin: 48px 0 16px; font-weight: 600; }
    .blog-content h3 { color: var(--heading); font-size: 20px; margin: 32px 0 12px; font-weight: 600; }
    .blog-content p { margin-bottom: 20px; }
    .blog-content ul, .blog-content ol { margin-bottom: 20px; padding-left: 24px; }
    .blog-content li { margin-bottom: 8px; }
    .blog-content strong { color: var(--heading); font-weight: 600; }
    .blog-content code { font-family: var(--font-mono); font-size: 0.9em; background: var(--bg-light); padding: 2px 6px; border-radius: 4px; color: var(--accent); }
    .blog-content pre { background: var(--bg-light); border: 1px solid var(--card-border); border-radius: 8px; padding: 20px; overflow-x: auto; margin-bottom: 24px; font-size: 14px; line-height: 1.6; }
    .blog-content pre code { background: none; padding: 0; color: var(--text-light); }
    .blog-content a { color: var(--accent); text-decoration: underline; text-underline-offset: 3px; }
    .blog-content a:hover { color: var(--heading); }
    .blog-content table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 15px; }
    .blog-content th, .blog-content td { padding: 12px 16px; border: 1px solid var(--card-border); text-align: left; }
    .blog-content th { background: var(--bg-light); color: var(--heading); font-weight: 600; }
    .blog-footer { margin-top: 60px; padding-top: 32px; border-top: 1px solid var(--card-border); }
    .blog-author { display: flex; align-items: center; gap: 16px; }
    .blog-author-img { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
    .blog-author-info h4 { color: var(--heading); font-size: 16px; }
    .blog-author-info p { color: var(--text); font-size: 14px; }
    .blog-cta { margin-top: 32px; text-align: center; }
    .blog-cta a { display: inline-block; padding: 12px 28px; border: 1px solid var(--accent); color: var(--accent); border-radius: 6px; font-family: var(--font-mono); font-size: 14px; transition: var(--transition); }
    .blog-cta a:hover { background: var(--accent-muted); }
    @media (max-width: 768px) { .blog-post { padding-top: calc(var(--nav-height) + 20px); } .blog-content { font-size: 16px; } }
  </style>
</head>
<body>
  <nav class="nav" id="nav" aria-label="Main navigation">
    <a href="../index.html" class="nav-logo" aria-label="Humza Tareen - Home">HT</a>
    <div class="nav-links" role="list">
      <div class="page-switcher"><a href="../engineering.html">Engineering</a><a href="../research.html">Research</a></div>
      <a href="../engineering.html#articles" role="listitem">All Articles</a>
      <a href="../engineering.html#contact" class="nav-cta" role="listitem">Hire Me</a>
    </div>
  </nav>
  <main class="blog-post">
    <a href="../engineering.html#articles" class="blog-back"><i class="fas fa-arrow-left"></i> All Articles</a>
    <article>
      <header class="blog-header">
        <h1 class="blog-title">Building an RL Training Arena: Gym-Style API and Cloud Build Sandboxing</h1>
        <div class="blog-meta"><time datetime="2026-02-08">Feb 8, 2026</time><span>&middot;</span><span>8 min read</span><span>&middot;</span><span>Humza Tareen</span></div>
        <div class="blog-tags">
          <span class="blog-tag">Reinforcement Learning</span><span class="blog-tag">GKE</span><span class="blog-tag">Cloud Build</span><span class="blog-tag">Redis</span><span class="blog-tag">Python</span>
        </div>
      </header>
      <div class="blog-content">
        <p>How do you train an AI coding agent to get better at writing code? Not with fine-tuning on more data — with reinforcement learning. Give it a coding task, let it try, measure whether the code passes tests, and use that signal to improve. The RL Training Arena provides this environment — a Gym-style RL system built on GCP that lets agents learn from structured feedback.</p>
        
        <h2>The Executor: A Gym for Code Agents</h2>
        <p>The executor service exposes a Gym-style API that RL researchers already understand. Create an episode, execute steps, compute rewards. The API shape follows OpenAI Gym conventions:</p>
        <pre><code># Create a new training episode
POST /episodes
{
  "task_id": "task-123",
  "agent_config": {...}
}
→ { "episode_id": "ep-456" }

# Execute an action step
POST /episodes/ep-456/steps
{
  "action": "write_file('src/main.py', '...')"
}
→ { "observation": "...", "done": false }

# Get reward signal
GET /episodes/ep-456/reward
→ { "reward": 0.75, "metrics": {...} }</code></pre>
        <p>Why this API shape? RL researchers already know how to use Gym environments. We're not reinventing the wheel — we're adapting it for code execution in the cloud.</p>
        
        <h2>Sandboxed Execution with Cloud Build</h2>
        <p>Agents run untrusted code. You can't let them touch the network, read other evaluations, or consume unbounded resources. Cloud Build provides isolated containers with no network access, hard timeouts, resource limits, and read-only filesystems.</p>
        <p>The trade-off: Cloud Build adds latency (~10s container startup) but guarantees isolation. Each agent execution runs in a fresh container that can't see anything outside its sandbox. If an agent tries to make a network request, it fails. If it tries to read files outside its workspace, it fails. If it runs too long, Cloud Build kills it.</p>
        <p>This isolation is non-negotiable. Without it, one malicious or buggy agent could corrupt the entire training environment.</p>
        
        <h2>Three-Tier State Management</h2>
        <p>State management follows a three-tier architecture, each tier chosen for its access pattern:</p>
        <p><strong>Redis</strong> holds episode state — fast, ephemeral. Episodes last minutes to hours, and we need sub-second lookups for reward computation. Redis fits perfectly.</p>
        <p><strong>Firestore</strong> stores trajectories — persistent, queryable. Training data lives forever. Researchers need to query "all episodes where reward > 0.8" or "episodes from agent X in the last week." Firestore's query engine handles this.</p>
        <p><strong>Cloud SQL</strong> manages task configuration — relational, schema-managed. Tasks have complex relationships (dependencies, prerequisites, difficulty tiers), and SQL's relational model makes these queries natural.</p>
        <p>Each tier does what it's best at. Redis for speed, Firestore for queries, SQL for relationships.</p>
        
        <h2>The Preprocessor: Turning Repos into Training Tasks</h2>
        <p>The preprocessor is a multi-step pipeline that takes a raw GitHub repository and produces a complete RL training task. Why this complexity? Each step reduces the manual work a researcher would otherwise do to set up a single training task.</p>
        <p>The flow: clone the repo → detect the primary language → resolve dependencies → discover all tests → run baseline to establish ground truth → generate verifiers → configure rewards → estimate difficulty → set resource limits → generate sandbox config → create prompts → define validation rules → package artifacts → upload to GCS.</p>
        <p>Without the preprocessor, setting up one training task would take hours. With it, a researcher points at a GitHub repo and gets a fully configured task in minutes. The preprocessor handles edge cases — missing dependencies, flaky tests, unclear success criteria — that would otherwise require manual intervention.</p>
        
        <h2>Getting the Reward Function Right</h2>
        <p>The reward function is where RL theory meets engineering reality. Too sparse rewards and agents don't learn. Too dense and they game the metric. The final formula balances test passage, code style, time efficiency, and error penalties:</p>
        <pre><code>def compute_reward(episode):
    base_reward = 1.0 if episode.tests_passed else 0.0
    style_bonus = compute_style_score(episode.code)
    time_penalty = max(0, 1.0 - episode.duration / episode.max_duration)
    error_penalty = -0.1 * episode.error_count
    
    return base_reward + 0.2 * style_bonus + 0.1 * time_penalty + error_penalty</code></pre>
        <p>This formula went through multiple iterations. Early versions rewarded test passage only, and agents learned to write code that passed tests but was unreadable. Adding style bonuses fixed that. Then agents learned to finish instantly with trivial solutions — the time penalty encourages exploration. The error penalty discourages random code generation.</p>
        <p>Reward engineering is an art. The formula looks simple, but each coefficient was tuned through experimentation.</p>
        
        <h2>Hexagonal Architecture</h2>
        <p>The core RL domain logic is decoupled from GCP infrastructure. Why? Switching from Cloud Build to local Docker for development means changing an adapter, not rewriting domain logic.</p>
        <p>The executor defines interfaces: <code>SandboxExecutor</code>, <code>StateStore</code>, <code>RewardComputer</code>. Concrete implementations — <code>CloudBuildExecutor</code>, <code>RedisStateStore</code>, <code>FirestoreTrajectoryStore</code> — live in adapter layers.</p>
        <p>This architecture makes testing easier (mock the adapters), development faster (run locally with Docker), and migration possible (swap Cloud Build for another sandbox without touching domain code).</p>
      </div>
      <footer class="blog-footer">
        <div class="blog-author"><img src="../suit-blue-bg.jpg" alt="Humza Tareen" class="blog-author-img"><div class="blog-author-info"><h4>Humza Tareen</h4><p>AI Engineer building production systems at scale. <a href="../engineering.html">View full portfolio</a></p></div></div>
        <div class="blog-cta"><a href="../engineering.html#articles">Read More Articles</a></div>
      </footer>
    </article>
  </main>
</body>
</html>
