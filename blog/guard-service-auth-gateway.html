<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Building an Auth Gateway with Admin Dashboard: JWT, OIDC, and Notifications Admin — Humza Tareen</title>
  <meta name="description" content="How I built the authentication gateway with Google OIDC, JWT, Kong integration, a notifications admin dashboard, and route cache invalidation.">
  <meta name="author" content="Humza Tareen">
  <meta name="keywords" content="Authentication, JWT, OIDC, API Gateway, Kong, Cloud Run, PostgreSQL, React, Admin Dashboard">
  <link rel="canonical" href="https://humzakt.github.io/blog/guard-service-auth-gateway.html">
  <meta property="og:title" content="Building an Auth Gateway with Admin Dashboard: JWT, OIDC, and Notifications Admin">
  <meta property="og:description" content="How I built the authentication gateway with Google OIDC, JWT, Kong integration, a notifications admin dashboard, and route cache invalidation.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://humzakt.github.io/blog/guard-service-auth-gateway.html">
  <meta property="og:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <meta property="og:site_name" content="Humza Tareen">
  <meta property="article:published_time" content="2026-02-08T00:00:00Z">
  <meta property="article:author" content="Humza Tareen">
  <meta property="article:tag" content="Authentication">
  <meta property="article:tag" content="API Gateway">
  <meta property="article:tag" content="JWT">
  <meta property="article:tag" content="Kong">
  <meta property="article:tag" content="React">
  <meta property="article:tag" content="Cloud Run">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building an Auth Gateway with Admin Dashboard: JWT, OIDC, and Notifications Admin">
  <meta name="twitter:description" content="How I built the authentication gateway with Google OIDC, JWT, Kong integration, a notifications admin dashboard, and route cache invalidation.">
  <meta name="twitter:image" content="https://humzakt.github.io/suit-blue-bg.jpg">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "Building an Auth Gateway with Admin Dashboard: JWT, OIDC, and Notifications Admin",
    "description": "How I built the authentication gateway with Google OIDC, JWT, Kong integration, a notifications admin dashboard, and route cache invalidation.",
    "image": "https://humzakt.github.io/suit-blue-bg.jpg",
    "author": { "@type": "Person", "name": "Humza Tareen", "url": "https://humzakt.github.io" },
    "publisher": { "@type": "Person", "name": "Humza Tareen" },
    "datePublished": "2026-02-08",
    "dateModified": "2026-02-08",
    "mainEntityOfPage": { "@type": "WebPage", "@id": "https://humzakt.github.io/blog/guard-service-auth-gateway.html" },
    "keywords": ["Authentication", "JWT", "OIDC", "API Gateway", "Kong", "Cloud Run", "PostgreSQL", "React", "Admin Dashboard"],
    "articleSection": "Security & Auth"
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="stylesheet" href="../styles.css">
  <link rel="alternate" type="application/rss+xml" title="Humza Tareen Blog" href="https://humzakt.github.io/blog/feed.xml">
  <style>
    .blog-post { max-width: 800px; margin: 0 auto; padding: calc(var(--nav-height) + 40px) 24px 80px; }
    .blog-back { display: inline-flex; align-items: center; gap: 8px; color: var(--accent); font-family: var(--font-mono); font-size: 14px; margin-bottom: 32px; }
    .blog-back:hover { gap: 12px; }
    .blog-header { margin-bottom: 40px; }
    .blog-title { font-size: clamp(28px, 5vw, 42px); color: var(--heading); line-height: 1.2; margin-bottom: 16px; font-weight: 700; }
    .blog-meta { display: flex; flex-wrap: wrap; align-items: center; gap: 16px; color: var(--text); font-size: 14px; font-family: var(--font-mono); margin-bottom: 24px; }
    .blog-meta time { color: var(--accent); }
    .blog-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
    .blog-tag { font-size: 12px; padding: 4px 12px; border-radius: 20px; background: rgba(100,255,218,0.08); color: var(--accent); font-family: var(--font-mono); }
    .blog-content { color: var(--text-light); line-height: 1.8; font-size: 17px; }
    .blog-content h2 { color: var(--heading); font-size: 24px; margin: 48px 0 16px; font-weight: 600; }
    .blog-content h3 { color: var(--heading); font-size: 20px; margin: 32px 0 12px; font-weight: 600; }
    .blog-content p { margin-bottom: 20px; }
    .blog-content ul, .blog-content ol { margin-bottom: 20px; padding-left: 24px; }
    .blog-content li { margin-bottom: 8px; }
    .blog-content strong { color: var(--heading); font-weight: 600; }
    .blog-content code { font-family: var(--font-mono); font-size: 0.9em; background: var(--bg-light); padding: 2px 6px; border-radius: 4px; color: var(--accent); }
    .blog-content pre { background: var(--bg-light); border: 1px solid var(--card-border); border-radius: 8px; padding: 20px; overflow-x: auto; margin-bottom: 24px; font-size: 14px; line-height: 1.6; }
    .blog-content pre code { background: none; padding: 0; color: var(--text-light); }
    .blog-content a { color: var(--accent); text-decoration: underline; text-underline-offset: 3px; }
    .blog-content a:hover { color: var(--heading); }
    .blog-content table { width: 100%; border-collapse: collapse; margin-bottom: 24px; font-size: 15px; }
    .blog-content th, .blog-content td { padding: 12px 16px; border: 1px solid var(--card-border); text-align: left; }
    .blog-content th { background: var(--bg-light); color: var(--heading); font-weight: 600; }
    .blog-footer { margin-top: 60px; padding-top: 32px; border-top: 1px solid var(--card-border); }
    .blog-author { display: flex; align-items: center; gap: 16px; }
    .blog-author-img { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
    .blog-author-info h4 { color: var(--heading); font-size: 16px; }
    .blog-author-info p { color: var(--text); font-size: 14px; }
    .blog-cta { margin-top: 32px; text-align: center; }
    .blog-cta a { display: inline-block; padding: 12px 28px; border: 1px solid var(--accent); color: var(--accent); border-radius: 6px; font-family: var(--font-mono); font-size: 14px; transition: var(--transition); }
    .blog-cta a:hover { background: var(--accent-muted); }
    @media (max-width: 768px) { .blog-post { padding-top: calc(var(--nav-height) + 20px); } .blog-content { font-size: 16px; } }
  </style>
</head>
<body>
  <nav class="nav" id="nav" aria-label="Main navigation">
    <a href="../index.html" class="nav-logo" aria-label="Humza Tareen - Home">HT</a>
    <div class="nav-links" role="list">
      <div class="page-switcher"><a href="../engineering.html">Engineering</a><a href="../research.html">Research</a></div>
      <a href="../engineering.html#articles" role="listitem">All Articles</a>
      <a href="../engineering.html#contact" class="nav-cta" role="listitem">Hire Me</a>
    </div>
  </nav>
  <main class="blog-post">
    <a href="../engineering.html#articles" class="blog-back"><i class="fas fa-arrow-left"></i> All Articles</a>
    <article>
      <header class="blog-header">
        <h1 class="blog-title">Building an Auth Gateway with Admin Dashboard: JWT, OIDC, and Notifications Admin</h1>
        <div class="blog-meta"><time datetime="2026-02-08">Feb 8, 2026</time><span>&middot;</span><span>7 min read</span><span>&middot;</span><span>Humza Tareen</span></div>
        <div class="blog-tags">
          <span class="blog-tag">Authentication</span><span class="blog-tag">API Gateway</span><span class="blog-tag">JWT</span><span class="blog-tag">Kong</span><span class="blog-tag">React</span><span class="blog-tag">Cloud Run</span>
        </div>
      </header>
      <div class="blog-content">
        <p>Every request to the platform goes through the guard service. It's the front door—the single point where authentication happens, authorization decisions are made, and traffic is routed to the right backend services. If authentication breaks here, everything breaks. If authorization logic fails, users can access resources they shouldn't. If routing goes wrong, requests disappear into the void. This is where reliability and security aren't nice-to-haves—they're existential requirements.</p>

        <h2>The Authentication Stack</h2>
        <p>The guard service implements a multi-layered authentication strategy, each layer serving a distinct purpose. Google OIDC handles web user authentication—when someone clicks "Sign in with Google," the OIDC flow validates their identity and establishes a session. JWT tokens manage that session state, allowing the frontend to prove authentication without hitting the database on every request. API keys enable service-to-service communication, letting backend services authenticate to each other without user context.</p>
        <p>This isn't just about supporting different use cases—it's about defense in depth. If one authentication method has a vulnerability, the others remain intact. The Kong API gateway sits in front of all of this, providing rate limiting, request transformation, and centralized routing logic. When a request arrives, Kong checks the authentication method, validates the credentials, and routes the request to the appropriate backend service based on the path and headers.</p>

        <h2>Building the Notifications Admin Dashboard</h2>
        <p>As the platform grew, we needed visibility into the notification system. How many subscriptions are active? Which notifications failed to deliver? What's the delivery success rate over time? These questions required an admin interface that could handle thousands of notification records without collapsing under the weight of the data.</p>
        <p>The React frontend needed sortable tables with pagination—loading all records at once would crash the browser. Row-click detail modals let admins drill into specific notifications without losing their place in the list. Subscription filtering (All vs Active) became essential as the number of subscriptions grew, allowing admins to focus on what matters. The engineering challenge wasn't just building the UI—it was building a responsive admin interface that could scale with the platform's growth.</p>
        <p>Each feature had to work together seamlessly. Click a row to see details, filter by subscription status, sort by delivery time, paginate through results—all without jarring transitions or lost state. The frontend communicates with the guard service's admin endpoints, which enforce proper authorization before returning sensitive notification data.</p>

        <h2>The Cache Invalidation Bug</h2>
        <p>API gateways cache routes for performance. When a request comes in for <code>/api/v1/services/123</code>, the gateway looks up the route configuration, caches it, and uses that cached configuration for subsequent requests. This works great—until the underlying data changes.</p>
        <p>We discovered a subtle bug: when an admin deleted a service, the database record was removed, but the API gateway's route cache wasn't invalidated. For up to five minutes, requests to the deleted service would still return 200 OK, making it appear as if the service still existed. Users would delete something, refresh the page, and see it still there. It was a classic "only two hard problems in computer science" moment—cache invalidation strikes again.</p>
        <p>The fix required explicit cache invalidation on every mutation operation. When a service is deleted, we now invalidate the route cache immediately, ensuring that subsequent requests return the correct 404 response:</p>
        <pre><code>async def delete_service(service_id: str):
    await db.delete(service_id)
    await route_cache.invalidate(f"service:{service_id}")
    # Before: stale route served 200 for 5 min after deletion
    # After: immediate 404 response
    return {"status": "deleted"}</code></pre>
        <p>This pattern extends to all mutation operations—create, update, delete—each one now explicitly invalidates the relevant cache entries. The performance benefit of caching remains, but the correctness guarantee is restored.</p>

        <h2>The Invite Auth Flow</h2>
        <p>User invitations are a critical onboarding flow. An admin invites a new user, they receive an email with a special link, click it, authenticate via OAuth, and gain access. Two subtle bugs made this flow unreliable.</p>
        <p>First, the invite URL pointed to the wrong OAuth callback endpoint. When users clicked the invite link, they'd authenticate successfully, but the callback handler didn't recognize the invite token, leaving them in a partially authenticated state. The fix was straightforward—correct URL construction—but finding it required tracing through the entire OAuth flow.</p>
        <p>Second, accepting an invite could accidentally downgrade an existing user's role. If a user already had an account with elevated permissions, accepting a new invite with lower permissions would overwrite their existing role. The fix required role comparison logic: only upgrade roles, never downgrade. A user with admin access shouldn't lose that access just because they clicked an invite link meant for a different role.</p>

        <h2>Security Audit</h2>
        <p>A comprehensive security audit revealed several vulnerabilities that, while not immediately exploitable, represented significant risks as the platform scaled. The audit process was systematic—examining authentication flows, authorization checks, data storage patterns, and API surface area.</p>
        <p>Hardcoded Cloud Run URLs in the OpenAPI specification exposed internal endpoints to anyone who could access the API docs. This information disclosure vulnerability meant that internal service endpoints were discoverable, even if they weren't directly accessible. Removing these hardcoded URLs and using environment-based configuration closed this information leak.</p>
        <p>JWT tokens stored in localStorage created an XSS risk. If any JavaScript on the page had an XSS vulnerability, an attacker could steal the JWT token and impersonate the user. Moving JWTs to httpOnly cookies eliminated this risk—the token is no longer accessible to JavaScript, only to the browser's cookie mechanism.</p>
        <p>Missing OAuth state validation left the authentication flow vulnerable to CSRF attacks. Without state validation, an attacker could trick a user into authenticating and redirecting to an attacker-controlled callback URL. Adding proper state validation ensures that the OAuth callback can only be used with the original authorization request.</p>
        <p>Console.log statements throughout the codebase were leaking sensitive data—user IDs, API keys, request payloads—into browser console logs. In production, these logs could be captured by browser extensions or developer tools, exposing sensitive information. Removing these debug statements and implementing proper logging infrastructure eliminated the data leak.</p>
        <p>Each finding represented a lesson in defense-in-depth security. No single vulnerability would have been catastrophic on its own, but together they represented a significant attack surface. Addressing them systematically made the platform more resilient to both known and unknown threats.</p>
      </div>
      <footer class="blog-footer">
        <div class="blog-author"><img src="../suit-blue-bg.jpg" alt="Humza Tareen" class="blog-author-img"><div class="blog-author-info"><h4>Humza Tareen</h4><p>AI Engineer building production systems at scale. <a href="../engineering.html">View full portfolio</a></p></div></div>
        <div class="blog-cta"><a href="../engineering.html#articles">Read More Articles</a></div>
      </footer>
    </article>
  </main>
</body>
</html>
